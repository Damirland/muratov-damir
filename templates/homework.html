<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è 8–ê</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìö</text></svg>">
    <style>
        /* –¢–µ –∂–µ —Å—Ç–∏–ª–∏, —á—Ç–æ –∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π */
        :root { --bg-color: #f0f2f5; --card-bg: #ffffff; --primary-blue: #007bff; --text-main: #2c3e50; --text-muted: #7f8c8d; }
        body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; color: var(--text-main); }
        h1 { text-align: center; margin-bottom: 30px; color: var(--primary-blue); }
        .timetable { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; max-width: 1600px; margin: 0 auto; width: 100%; }
        .day-card { background: var(--card-bg); border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); padding: 15px; flex: 1 1 200px; max-width: none; }
        .day-title { font-size: 20px; font-weight: bold; color: var(--primary-blue); border-bottom: 2px solid #eef2f7; padding-bottom: 10px; margin-bottom: 15px; text-align: center; }
        .lesson { padding: 12px; margin-bottom: 10px; border-radius: 10px; border-left: 5px solid #ccc; background: #f8f9fa; }
        .lesson-main { display: flex; justify-content: space-between; align-items: center; gap: 10px; font-weight: 600;}
        .day-card.today { border: 2px solid var(--primary-blue); box-shadow: 0 0 20px rgba(0, 123, 255, 0.15); position: relative; }
        
        /* –ù–û–í–´–ô –°–¢–ò–õ–¨: –ñ–µ–ª—Ç–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –¥–æ–º–∞—à–∫–∏ */
        .homework-box {
            margin-top: 10px;
            padding: 8px 12px;
            background: #fff8d6;
            border-left: 4px solid #fcc419;
            border-radius: 6px;
            font-size: 14px;
            color: #5c4b00;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .loader-container { width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 50px 0; color: var(--primary-blue); font-weight: 600; }
        .spinner { width: 40px; height: 40px; border: 4px solid rgba(0, 123, 255, 0.2); border-top: 4px solid var(--primary-blue); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .creator-badge { position: absolute; top: 20px; right: 20px; font-size: 14px; font-weight: 600; color: var(--text-muted); text-decoration: none; background: var(--card-bg); padding: 6px 12px; border-radius: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); transition: all 0.3s ease; }
        .creator-badge:hover { color: var(--primary-blue); box-shadow: 0 4px 12px rgba(0, 123, 255, 0.2); transform: translateY(-2px); }
        @media (max-width: 600px) { .creator-badge { position: relative; display: block; top: 0; right: 0; width: max-content; margin: 0 auto 15px auto; text-align: center; } h1 { margin-top: 5px; } }
    </style>
</head>
<body>
    <a href="https://t.me/wisposhka" target="_blank" class="creator-badge">@wisposhka</a>

    <h1>–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è 8–ê</h1>
    
    <div style="text-align: center; margin-bottom: 20px;">
        <a href="/" style="text-decoration: none; padding: 10px; color: #007bff;">–î–Ω–µ–≤–Ω–∏–∫</a> | 
        <a href="/main" style="text-decoration: none; padding: 10px; color: #007bff;">–û—Å–Ω–æ–≤–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a> |
        <span style="padding: 10px; color: #7f8c8d; font-weight: bold;">–î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è</span>
    </div>

    <div class="timetable" id="timetableContainer">
        <div class="loader-container">
            <div class="spinner"></div>
            <div>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞–Ω–∏–π...</div>
        </div>
    </div>

    <script>
        async function fetchHomework() {
            try {
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –∏ –¥–æ–º–∞—à–∫—É
                const [scheduleRes, hwRes] = await Promise.all([
                    fetch('/api/timetable'),
                    fetch('/api/homework')
                ]);
                
                const lessons = await scheduleRes.json();
                const hwData = await hwRes.json();

                const fullWeek = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞'];
                const hwMap = {};

                // –§—É–Ω–∫—Ü–∏—è-–ø–æ–º–æ—â–Ω–∏–∫: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –ø—Ä–µ–¥–º–µ—Ç –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å
                function subjectExistsOnDay(subject, day) {
                    return lessons.some(l => l.day === day && l.subject === subject);
                }

                // === –£–ú–ù–ê–Ø –°–û–†–¢–ò–†–û–í–ö–ê –ò –ü–ï–†–ï–ù–û–° –î–û–ú–ê–®–ö–ò ===
                hwData.forEach(hw => {
                    if (hw.task === "-") return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —É–¥–∞–ª–µ–Ω–Ω—É—é –¥–æ–º–∞—à–∫—É

                    let startIndex = fullWeek.indexOf(hw.day);
                    let targetDay = hw.day; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—ã—Ç–∞–µ–º—Å—è –ø–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ —Ç–æ—Ç –¥–µ–Ω—å, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –∑–∞–¥–∞–ª–∏

                    if (startIndex !== -1) {
                        let found = false;
                        
                        // 1. –ò—â–µ–º —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç –Ω–∞—á–∏–Ω–∞—è —Å –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –¥–Ω—è –∏ –¥–≤–∏–≥–∞–µ–º—Å—è –≤–ø–µ—Ä–µ–¥ –¥–æ –ø—è—Ç–Ω–∏—Ü—ã
                        for (let i = startIndex; i < fullWeek.length; i++) {
                            if (subjectExistsOnDay(hw.subject, fullWeek[i])) {
                                targetDay = fullWeek[i];
                                found = true;
                                break;
                            }
                        }
                        
                        // 2. –ï—Å–ª–∏ –≤–ø–µ—Ä–µ–¥–∏ —É—Ä–æ–∫–∞ –Ω–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—è—Ç–Ω–∏—á–Ω—É—é —Ö–∏–º–∏—é –æ—Ç–º–µ–Ω–∏–ª–∏), 
                        // –∏—â–µ–º –µ–≥–æ –≤ –Ω–∞—á–∞–ª–µ –Ω–µ–¥–µ–ª–∏ (—Å –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞), —á—Ç–æ–±—ã –¥–æ–º–∞—à–∫–∞ –Ω–µ –ø–æ—Ç–µ—Ä—è–ª–∞—Å—å!
                        if (!found) {
                            for (let i = 0; i < startIndex; i++) {
                                if (subjectExistsOnDay(hw.subject, fullWeek[i])) {
                                    targetDay = fullWeek[i];
                                    break;
                                }
                            }
                        }
                    }

                    // –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º –¥–æ–º–∞—à–∫—É –∫ –Ω–∞–π–¥–µ–Ω–Ω–æ–º—É (–∏–ª–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É) –¥–Ω—é
                    const key = `${targetDay}_${hw.subject}`;
                    
                    // –ï—Å–ª–∏ –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å —É–∂–µ —Å—ä–µ—Ö–∞–ª–∞—Å—å –∫–∞–∫–∞—è-—Ç–æ –¥—Ä—É–≥–∞—è –¥–æ–º–∞—à–∫–∞ –ø–æ —ç—Ç–æ–º—É –ø—Ä–µ–¥–º–µ—Ç—É, 
                    // –º—ã –Ω–µ —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é, –∞ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Å–∫–ª–µ–∏–≤–∞–µ–º –∏—Ö!
                    if (hwMap[key]) {
                        hwMap[key] += `<br><br><span style="color:#025cbd; font-size:12px;">+ –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ:</span><br>` + hw.task;
                    } else {
                        hwMap[key] = hw.task;
                    }
                });

                // –ü–µ—Ä–µ–¥–∞–µ–º —É–º–Ω—É—é –∫–∞—Ä—Ç—É –¥–æ–º–∞—à–µ–∫ –≤ —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
                renderHomework(lessons, hwMap);
            } catch (err) {
                console.error("–û—à–∏–±–∫–∞:", err);
                document.getElementById('timetableContainer').innerHTML = '<div class="loader-container" style="color: #e74c3c;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏.</div>';
            }
        }

        function renderHomework(lessons, hwMap) {
            const container = document.getElementById('timetableContainer');
            container.innerHTML = '';
            
            const daysData = {};
            lessons.forEach(lesson => {
                if (!daysData[lesson.day]) daysData[lesson.day] = [];
                daysData[lesson.day].push(lesson);
            });

            const fullWeek = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞'];
            const todayName = new Intl.DateTimeFormat('ru-RU', { weekday: 'long' }).format(new Date());
            const capitalizedToday = todayName.charAt(0).toUpperCase() + todayName.slice(1);

            fullWeek.forEach(day => {
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                if (day === capitalizedToday) dayCard.classList.add('today');
                dayCard.innerHTML = `<div class="day-title">${day}</div>`;
                
                const dayLessons = daysData[day];
                let hasHomeworkForDay = false; // –§–ª–∞–≥, –µ—Å—Ç—å –ª–∏ –≤–æ–æ–±—â–µ –¥–æ–º–∞—à–∫–∞ –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å

                if (dayLessons && dayLessons.length > 0) {
                    dayLessons.sort((a, b) => a.lesson_num - b.lesson_num);
                    dayLessons.forEach(lesson => {
                        // –ò—â–µ–º –¥–æ–º–∞—à–∫—É –ø–æ –∫–ª—é—á—É "–î–µ–Ω—å_–ü—Ä–µ–¥–º–µ—Ç"
                        const task = hwMap[`${day}_${lesson.subject}`];
                        
                        // –ï—Å–ª–∏ –¥–æ–º–∞—à–∫–∞ –µ—Å—Ç—å, —Ä–∏—Å—É–µ–º –∫–∞—Ä—Ç–æ—á–∫—É —É—Ä–æ–∫–∞
                        // –ï—Å–ª–∏ –¥–æ–º–∞—à–∫–∞ –µ—Å—Ç—å, —Ä–∏—Å—É–µ–º –∫–∞—Ä—Ç–æ—á–∫—É —É—Ä–æ–∫–∞
                        if (task) {
                            hasHomeworkForDay = true;
                            const lessonDiv = document.createElement('div');
                            lessonDiv.className = 'lesson';
                            
                            // –¢–≤–æ—è —Ç–æ—á–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤
                            const colors = {
                                '–ê–ª–≥–µ–±—Ä–∞': '#4c6ef5', 
                                '–ì–µ–æ–º–µ—Ç—Ä–∏—è': '#4c6ef5',
                                '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞': '#4c6ef5', 
                                '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞': '#4c6ef5',
                                '–†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ': '#4c6ef5',

                                '–†—É—Å—Å–∫–∏–π —è–∑—ã–∫': '#ff922b', 
                                '–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞': '#ff922b',
                                '–ü—Ä–∞–∫—Ç–∏–∫—É–º –ø–æ —Ä—É—Å—Å–∫–æ–º—É —è–∑—ã–∫—É': '#ff922b', 
                                '–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥—Ä–∞–º–æ—Ç–Ω–æ—Å—Ç—å': '#ff922b',

                                '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫': '#e03131', 
                                '–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫ / –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞': '#c2255b',

                                '–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞': '#845ef7', 
                                '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞': '#7048e8',

                                '–§–∏–∑–∏–∫–∞': '#15aabf', 
                                '–•–∏–º–∏—è': '#0ca678', 
                                '–ë–∏–æ–ª–æ–≥–∏—è': '#40c057',
                                '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è': '#fab005',

                                '–ò—Å—Ç–æ—Ä–∏—è': '#fa5252', 
                                '–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ': '#be4bdb', 
                                '–°–µ–º—å–µ–≤–µ–¥–µ–Ω–∏–µ': '#f06595',
                                '–û–ë–ó–†': '#5c940d',

                                '–§–∏–∑–∫—É–ª—å—Ç—É—Ä–∞': '#51cf66', 
                                '–ú—É–∑—ã–∫–∞': '#fcc419', 
                                '–¢—Ä—É–¥': '#a34e24',
                                '–ö–ª–∞—Å—Å–Ω—ã–π —á–∞—Å': '#20c997'
                            };

                            // –ë–µ—Ä–µ–º —Ü–≤–µ—Ç –∏–∑ –ø–∞–ª–∏—Ç—Ä—ã (–µ—Å–ª–∏ –ø—Ä–µ–¥–º–µ—Ç–∞ –≤–¥—Ä—É–≥ –Ω–µ—Ç, —Å—Ç–∞–≤–∏–º —Å–µ—Ä—ã–π #ccc)
                            const subjectColor = colors[lesson.subject] || '#ccc';
                            
                            // –ö—Ä–∞—Å–∏–º –ª–µ–≤—É—é –ø–æ–ª–æ—Å–∫—É –∫–∞—Ä—Ç–æ—á–∫–∏
                            lessonDiv.style.borderLeftColor = subjectColor;

                            // –°–æ–±–∏—Ä–∞–µ–º —Å–∞–º—É –∫–∞—Ä—Ç–æ—á–∫—É (–∂–µ–ª—Ç—ã–π –±–ª–æ–∫ –¥–ª—è –¥–æ–º–∞—à–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å)
                            lessonDiv.innerHTML = `
                                <div class="lesson-main">
                                    <span style="color: var(--primary-blue)">${lesson.subject}</span>
                                </div>
                                <div class="homework-box">
                                    <strong>–î–ó:</strong> ${task.replace(/\n/g, '<br>')}
                                </div>
                            `;
                            dayCard.appendChild(lessonDiv);
                        }
                    });
                } 
                
                if (!hasHomeworkForDay) {
                    dayCard.innerHTML += `<div style="text-align:center; color:#aaa; font-style:italic; padding: 20px 0;">–ó–∞–¥–∞–Ω–∏–π –Ω–µ—Ç ü•≥</div>`;
                }

                container.appendChild(dayCard);
            });
        }
        window.onload = fetchHomework;
    </script>
</body>
</html>